<h1>Revenue Split</h1>
<script>
	var maxPercent = <%= @project.project_type.team_total_percent %>;
	var total = 0;
	
	jQuery.validator.addMethod("revenueSplitValidation", function(value, element, params)
	{       
		total = 0;
        $(params[0]).each(function() {
            total += parseFloat($(this).val());
        });

        return this.optional(element) || total <= parseFloat(value);
	}, jQuery.validator.format("You have exceed " + maxPercent + "% Please adjust the percents so they sum up accordingly."));
	
</script>
<div>
	<%= simple_form_for @project,
	 url: url_for(:controller => 'projects', :action => 'revenue_allocation_split',
                      id: @project), html: { id: "revenue_allocation_split" } do | f| %>
                      
		<%= f.simple_fields_for :team_memberships do | builder | %>
            <% next if builder.object.new_record? %>

            <%= builder.object.member.name %>
			<%= builder.input :id, as: :hidden %>
			<%= builder.input :percentage, label: builder.object.role.name + " Percentage ", input_html: { class: "percentage" }  %><br />
		<% end %>
		
		<%= hidden_field_tag :submitted_task_id, current_tab.task.id %>

		<%= hidden_field_tag :fullAmount, @project.project_type.team_total_percent %><br />

		<span><strong>Total:</strong> <span id="split_threshold">0</span> <font color="#ff0000">Must not exceed <%= @project.project_type.team_total_percent %>%</font></span><br /><br />		
		
		<%= select_date (Date.today.day == 1)? Date.today : Date.today + 1.month, prefix: :effective_date, start_year: Date.today.year, discard_day: true %><br /><br />
		<div>The date you would like this allocation agreement to take effect.</div><br />	
		<%= f.submit 'submit' %>
	<% end %>
</div>
	
	